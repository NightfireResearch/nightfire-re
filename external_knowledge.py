
# Take knowledge from outside the provided files, to make this easier to work with

# https://tcrf.net/James_Bond_007:_NightFire_(GameCube)
# This is apparently located within def_Startup.cfg in the Gamecube version
hashcode_name_mapping = {
    "07000001": "HT_Level_HendersonA",
    "07000002": "HT_Level_HendersonB",
    "07000003": "HT_Level_HendersonC",
    "07000004": "HT_Level_HendersonD",
    "07000005": "HT_Level_CastleExterior",
    "07000006": "HT_Level_CastleCourtyard",
    "07000007": "HT_Level_CastleIndoors1",
    "07000008": "HT_Level_CastleIndoors2",
    "07000009": "HT_Level_TowerA",
    "0700000a": "HT_Level_TowerB",
    "0700000b": "HT_Level_TowerC",
    "0700000c": "HT_Level_PowerStationA1",
    "0700000d": "HT_Level_PowerStationA2",
    "07000011": "HT_Level_Tower2A",
    "07000012": "HT_Level_Tower2B",
    "07000013": "HT_Level_Tower2C",
    "0700004a": "HT_Level_Tower2Elevator",
    "07000014": "HT_Level_EvilBase",
    "07000015": "HT_Level_EvilSilo",
    "07000016": "HT_Level_EvilBaseC",
    "0700001b": "HT_Level_SpaceStationD",
    "07000021": "HT_Level_SpaceStation",
    "07000022": "HT_Level_Facility",
    "07000023": "HT_Level_Atlantis",
    "07000024": "HT_Level_SkyRail",
    "07000025": "HT_Level_SubPen",
    "07000026": "HT_Level_StealthShip",
    "07000027": "HT_Level_FortKnox",
    "07000028": "HT_Level_MissileSilo",
    "07000029": "HT_Level_SnowBlind",
    "0700004b": "HT_Level_Ravine",
    "07000041": "HT_Level_RefRoom",
    "07000043": "HT_Level_AllCharacters",
    "07000046": "HT_Level_TestRoom2",
    "07000049": "HT_Level_AllCharacters2",
    "07000048": "HT_Level_Menu_Pre",
    "07000090": "HT_Level_MovieMap",
    "07000500": "LevelLoadingScreens" 
}

archive_names = {

 # MP skins - all entities starting "Mp_", "MP_", and some manually-added extras
 '0100012a': 'skins/MP_Renard',
 '0100012d': 'skins/MP_Scaramanga',
 '0100012f': 'skins/MP_Goldfinger',
 '0100015a': 'skins/Mp_pussy_galore',
 '0100016a': 'skins/Mp_christmas_jones',
 '01000170': 'skins/Mp_wai_lin',
 '0100017e': 'skins/Mp_baron_samedi',
 '010001a1': 'skins/Mp_nick_nack',
 '010001aa': 'skins/Mp_mayday',
 '010001ad': 'skins/Mp_jaws',
 '010001ae': 'skins/Mp_odd_job',
 '010001af': 'skins/Mp_xenia_onatopp',
 '010001b4': 'skins/Mp_bond_combat',
 '010001b7': 'skins/Mp_drake',
 '010001bc': 'skins/Mp_rook_scarred',
 '010001c5': 'skins/Mp_kiko_combat',
 '010001c9': 'skins/Mp_alura_combat',
 '010001d5': 'skins/Mp_domanique',
 '010001dd': 'skins/Mp_snow_guard',
 '010001de': 'skins/Mp_black_ops',
 '010001e1': 'skins/Mp_yakuza_suit',
 '010001e5': 'skins/Mp_phoenix_soldier',
 '010001e7': 'skins/Mp_ninja',
 '010001eb': 'skins/Mp_bond_tux',
 '010001ec': 'skins/Mp_drake_suit',
 '01000208': 'skins/MP_Zorin',
 '0100020b': 'skins/Mp_bond_spacesuit',
 '010001ab': "skins/Elektra_pants",
 '01000202': "skins/Bond_hands_femwhite",
 '01000201': "skins/Bond_hands_femblack",
 '010001fd': "skins/Bond_hands_malewhite",
 '01000200': "skins/Bond_hands_maleblack",

 # Named skins from SP
 '01000180': "skins/Hazmat_heavy_1",
 '010001a4': "skins/Hazmat_heavy_3",
 '01000137': "skins/Tech_a",
 '010000a7': "skins/Ninja",
 '01000083': "skins/Yakcoatopen",

 # Generic name in code (eg polySurface1) or misleading name - I've given an unique name to each
 '010000ed': "skins/CastleCourtyard_VanDriver",
 '0100005f': "skins/CastleExterior_GruntWithFullMask",
 '010000b0': "skins/CastleExterior_GruntWithHat",
 '010000af': "skins/CastleExterior_Grunt",
 '01000087': "skins/CastleIndoors2_MayhewTux",
 '010000b3': "skins/CastleIndoors2_BondTux",
 '01000106': "skins/CastleIndoors_Grunt1",
 '01000107': "skins/CastleIndoors_Grunt2",
 '01000108': "skins/CastleIndoors_Grunt3",
 '01000114': "skins/CastleIndoors_GruntSuit",
 '010000d4': "skins/CastleIndoors_PartyGuestDress1",
 '010000f5': "skins/CastleIndoors_PartyGuestDress2",
 '01000104': "skins/CastleIndoors_PartyGuestDress3",
 '0100010e': "skins/CastleIndoors_PartyGuestSuit1",
 '010000f4': "skins/CastleIndoors_Zoe",
 '010000f7': "skins/CastleIndoors_Dominique",
 '010000f8': "skins/CastleIndoors_Kiko",
 '010000ec': "skins/Drake_tux",
 '010000f6': "skins/Rook_suit",
 '0100006f': "skins/Henderson_Grunt1",
 '0100007a': "skins/Henderson_Grunt2",
 '010000c9': "skins/HendersonA_Kiko",
 '01000079': "skins/HendersonA_Civilian1",
 '01000075': "skins/HendersonA_BondBlueSuit",
 '01000096': "skins/Henderson_GruntWithBandana",
 '01000145': "skins/HendersonB_Mayhew",
 '010000ac': "skins/HendersonC_Civilian",
 '010000ad': "skins/HendersonC_Grunt3",
 '01000133': "skins/TowerA_CivilianSecurityGuard1",
 '01000134': "skins/TowerA_CivilianSecurityGuard2",
 '01000135': "skins/TowerB_CivilianSecurityGuard1",
 '01000136': "skins/TowerB_CivilianSecurityGuard2",
 '01000130': "skins/TowerC_Grunt",
 '0100019a': "skins/TowerC_Dominique",
 '01000158': "skins/TowerC_DrakeSuit",
 '01000157': "skins/Tower2A_Dominique",
 '01000164': "skins/Tower2A_Kiko",
 '01000167': "skins/Tower2A_Drake",
 '010000fe': "skins/Tower2B_CivilianOfficeWorker1",
 '01000103': "skins/Tower2B_CivilianOfficeWorker2",
 '01000131': "skins/Tower2B_GruntWithBandana",
 '01000132': "skins/Tower2B_GruntWithMask",
 '01000181': "skins/PowerStation_GruntHazmatNoMask",
 '010001b8': "skins/EvilBase_GruntWithGoggles",
 '010001c7': "skins/EvilBase_GruntWithBeret",
 '010001ff': "skins/EvilBase_GruntWithHelmet",
 '010001b0': "skins/EvilBase_GruntWithHelmet2",
 '01000179': "skins/EvilBase_RookScarred",
 '01000164': "skins/EvilBase_Kiko",
 '010001c3': "skins/GruntWithEyepatch",
 '010001fe': "skins/EvilSilo_GruntWithGoggles",
 '010001c2': "skins/SpaceStationD_DrakeSpacesuit",
 '010001f9': "skins/SpaceStationD_DrakeSpacesuitDead",
 '0100019b': "skins/SpaceStationD_Astronaut1",
 '010001a2': "skins/SpaceStationD_Astronaut2",
 '01000092': "skins/Bond_GenericBlackTacticalGear",
 '0100021b': "skins/MPGruntWithGogglesAndHelmet",


 # Manual naming - might not match internal name
 '0100008b': "weapons/Sniper_Green_3rd",
 '01000187': "weapons/Sniper_Green",
 '0100018c': "weapons/Sniper_Green2",
 '01000213': "weapons/SG5_Commando_White",
 '01000215': "weapons/SG5_Commando_White_3rd",
 '010001cd': "weapons/Sniper_White_3rd",
 '010000e1': "weapons/SnipersMixed",
 '0100018d': "weapons/Tripbomb",
 '0100018f': "weapons/Tripbomb_3rd",
 '010000ab': "weapons/FragGrenade",
 '01000185': "weapons/SmokeGrenade",
 '01000186': "weapons/Flashbang",
 '01000116': "weapons/DesertEagle",
 '01000153': "weapons/MP5K",
 '010001ce': "weapons/Crossbow",
 '01000115': "weapons/RLaunch",
 '01000188': "weapons/StickyMine",
 '01000207': "weapons/StickyMine_3rd",
 '0100013b': "weapons/Shotgun",
 '0100020d': "weapons/SamuraiMuzzleFlash",
 '010001c1': "weapons/Samurai_3rd",
 '01000172': "weapons/Suitcase1",
 '010001a8': "Weapons/Suitcase2",
 '01000171': "weapons/GunSamuri", # As spelled in entity list 
 '01000199': "weapons/SatchelCharge",
 '0100019f': "weapons/SatchelCharge2",
 '0100021a': "weapons/SatchelChargeDigits",
 '010001c4': "weapons/GoldenGun",
 '010001b9': "weapons/Grenade_Launcher",
 '010001cc': "weapons/Grenade_Launcher_3rd",
 '01000156': "weapons/Pistol",
 '010001b3': "weapons/PP7_Black",
 '010001f1': "weapons/PP7_Gold",
 '010001f3': "weapons/P2K_Black",
 '010001f0': "weapons/P2K_Gold",
 '010001ea': "weapons/P11",
 '010001a3': "weapons/Aims20", # unsure
 '010001a9': "weapons/Aims20_3rd", # Referred to as HK OICW in entity list
 '0100020e': "weapons/Torpedo_3rd",
 '010000cc': "weapons/unknown_010000cc",
 '010001cb': "weapons/Deagle_3rd",
 '010000cd': "weapons/unknown_010000cd",
 '010001cf': "weapons/GoldenGun_3rd",
 '010001d4': "weapons/PPK_3rd",
 '010001f4': "weapons/PPKS_3rd",
 '010001f5': "weapons/unknown_010001f5",
 '0100006b': "weapons/unknown_0100006b",
 '0100006d': "weapons/unknown_0100006d",
 '0100006e': "weapons/SG5_Commando_Black",
 '0100008a': "weapons/unknown_0100008a",
 '0100008c': "weapons/SMG_3rd",
 '0100008d': "weapons/SG5_Commando_Black_3rd",
 '0100015d': "weapons/unknown_0100015d",
 '01000144': "weapons/SPAS12_3rd",
 '010000bc': "weapons/MP5K_3rd",
 '01000174': "weapons/unknown_01000174",
 '010001ac': "weapons/unknown_010001ac",
 '01000073': "weapons/MuzzleFlash_Ruger",
 '010000a6': "weapons/MuzzleFlash_Sig",
 '01000204': "weapons/OddjobHat",
 '010001a0': "weapons/Launcher1",
 '010001a5': "weapons/BeamLaser",
 '010000eb': "weapons/unknown_launcher",
 '010000ba': "weapons/NinjaSword_3rd",
 '010000bb': "weapons/NinjaGrenade_3rd",

 '01000160': "gadgets/QWorm",
 '01000101': "gadgets/Grapple",
 '0100011e': "gadgets/Key",
 '0100019d': "gadgets/Shaver1",
 '0100020c': "gadgets/Shaver2",
 '010001b1': "gadgets/Shaver3",
 '010001f8': "gadgets/Watch_BlackGloves",
 '010001e0': "gadgets/Watch_BareHands",
 '01000074': "gadgets/Watch3_MP",
 '01000071': "gadgets/Watch_Movables",
 '01000162': "gadgets/QPen",
 '01000161': "gadgets/PDA",
 '010000e3': "gadgets/Lighter",
 '01000122': "gadgets/LighterCam",
 '010000e2': "gadgets/Glasses",


 # Misc
 '010000f3': "ai_hints",
 '0100002d': "hit_sfx",
 '01000004': "smoke_dust",
 '0100002e': "environment",
 '01000081': "weapon_sfx",
 '010000cf': "common_objects",
 '010000ca': "mp_objects", # Pickups etc
 '010000da': "mp_RCCar",
 '010000d0': "vehicles/helicopter_phoenix",
 '01000163': "vehicles/helicopter_tower2b",
 '01000051': "vehicles/helicopter_castle",
 '010000d8': "vehicles/truck",
 '010000db': "vehicles/truck_corona_aibox",
 '01000168': "vehicles/forklift",
 '010000de': "vehicles/limo",
 '0100015f': "vehicles/van_phoenix",
 '01000147': "emplacements",
 '01000166': "markers",
 '010001d8': "font",
 '010000a2': "ui/pause",
 '01000070': "ui/overlay",
 '010001b5': "ui/weapon_sniperscope_overlay",
 '010001df': "ui/gadget_camera_overlay",
 '01000209': "ui/mission_spacestation_overlay",

}

# From ObjectPlacementTypes in Ghidra
placementTypes = {
    0x0f: "Place_Drone",
    0x20: "Place_Breakable",
    0x21: "Place_Ripples",
    0x22: "Place_Ladder",
    0x24: "Place_PlayerNewStartPos",
    0x25: "Place_MPSpawnPoint",
    0x26: "Place_MPObject",
    0x27: "Place_GunTurret",
    0x28: "Place_Sensor",
    0x29: "Place_Switch",
    0x2a: "Place_SkyObject",
    0x2b: "Place_LeafGen",
    0x2c: "Place_Lightning",
    0x2d: "Place_AddNewStartPos2",
    0x2e: "Place_Lock",
    0x2f: "Place_Copter",
    0x30: "Place_Monitor",
    0x31: "Place_FuseBox",
    0x32: "Place_RainBox",
    0x33: "Place_Hint",
    0x34: "Place_GunImp",
    0x35: "Place_PCQWorm",
    0x36: "Place_Sub",
    0x37: "Place_MiniSub",
    0x38: "Place_SpaceLaser",
    0x39: "Place_SpaceMissile",
    0x3a: "Place_Grapple",
    0x3b: "Place_DynamicObject",
    0x3e: "Place_Wire",
    0x3f: "Place_CreepWall",
    0x41: "Place_InverterTrigger",
    0x4a: "Place_Apocalypse",
    0x4e: "Place_Light",
    0x71: "Place_Rotor",
    0xd2: "Place_Shooter",
    0xd4: "Place_Cloud",
    0xd5: "Place_OneSided",
    0xd8: "Place_RigidBody",
    0xd9: "Place_ScriptPlayer",
    0xda: "Place_Car",
    0xdb: "Place_Door",
    0xdc: "Place_Trigger",
    0xde: "Place_Searchlight",
    0xdf: "Place_Env",
    0xe0: "Place_Creature",
    0xe1: "Place_Destroy",
    0xe2: "Place_SS",
    0xe3: "Place_Flicker",
    0xe4: "Place_Hurt",
    0xe5: "Place_DroneCoverCorner",
    0xe6: "Place_DroneCoverLow",
    0xe7: "Place_ThirdCam",
    0xe8: "Place_TriggerLoadLevel",
    0xe9: "Place_DroneAIPoint",
    0xea: "Place_TriggerTouchOnce",
    0xeb: "Place_TriggerTouch",
    0xec: "Place_TriggerMultiplexIn",
    0xed: "Place_TriggerMultiplexSIn",
    0xee: "Place_TriggerMultiplexOut",
    0xef: "Place_TriggerMultiplexOrIn",
    0xf0: "Place_Pickup",
    0xf1: "Place_DroneSpawner",
    0xf2: "Place_Emitter",
    0xf3: "Place_EnvTree",
    0xf4: "Place_TriggerMoviePlayer",
    0xf5: "Place_DroneAIVolume1",
    0xf8: "Place_DroneAIVolume2",
    0xf9: "Place_SoundTrigger",
    0xfa: "Place_ThirdIcon",
    0xfb: "Place_MusicTrigger",
    0xfc: "Place_Corona",
    0xfd: "Place_CamSubject",
    0xfe: "Place_Mine",
}


# From manual inspection of the files
text_start = 0x00107100
elf_header_size = 4096

def memaddr_to_elfaddr(memaddr):
    return (memaddr - text_start) + elf_header_size


filetable_offset_in_elf = memaddr_to_elfaddr(0x002453a0)
filetable_length = 118


# Starts at PS2 address 002e96a0 (1E35A0 in ELF), ends at 1EE520ish in ELF
sfxnametable_offset_start = memaddr_to_elfaddr(0x002e96a0)
sfxnametable_offset_end = 0x1EE538

# Caption Lookup for SFX
sndlbl_start = memaddr_to_elfaddr(0x002d33d8)
sndlbl_entry_size = 8
sndlbl_len_entries = 484
sndlbl_end = sndlbl_start + sndlbl_entry_size * sndlbl_len_entries

# SFX Properties
sfxdata_start = memaddr_to_elfaddr(0x002ca2a0)
sfxdata_entry_size = 0x18
sfxdata_num_entries = 1549
sfxdata_end = sfxdata_start + sfxdata_entry_size * sfxdata_num_entries

# NumberToHashCode
nthc_start = memaddr_to_elfaddr(0x00247c80)
nthc_entry_size = 8
nthc_num_entries = 1394
nthc_end = nthc_start + nthc_entry_size * nthc_num_entries

# HashCodeToString
hcts_start = memaddr_to_elfaddr(0x0024a810)
hcts_entry_size = 16
hcts_num_entries = 1394
hcts_end = hcts_start + hcts_entry_size * hcts_num_entries